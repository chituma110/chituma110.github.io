<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>程起上的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Goals determine what you are going to be">
<meta property="og:type" content="website">
<meta property="og:title" content="程起上的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="程起上的博客">
<meta property="og:description" content="Goals determine what you are going to be">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程起上的博客">
<meta name="twitter:description" content="Goals determine what you are going to be">
  
    <link rel="alternate" href="/atom.xml" title="程起上的博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">程起上的博客</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Goals determine what you are going to be</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">about</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Python写caffe层" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/22/Python写caffe层/" class="article-date">
  <time datetime="2017-03-22T02:08:22.000Z" itemprop="datePublished">2017-03-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/22/Python写caffe层/">Python写caffe层</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h1><p>因为工作需要，需要用Python写新层，正好也看过这方面的工作。今天就来小小的记录一下，以免自己忘记了。</p>
<p>Python写层最多的是看到些数据层。所以我们今天就写一个数据层的例子。我们一共分3步走。</p>
<h2 id="步奏一：写新层"><a href="#步奏一：写新层" class="headerlink" title="步奏一：写新层"></a>步奏一：写新层</h2><p>​    </p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#！-*- coding: utf-8 -*-</span></div><div class="line"><span class="comment">#author = Cqs</span></div><div class="line"><span class="comment">#FileName: MyPythonLayer.py  #1</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> caffe</div><div class="line"><span class="keyword">import</span> yaml, glob</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</div><div class="line"><span class="keyword">import</span> cv2</div><div class="line"><span class="keyword">import</span> logging</div><div class="line"></div><div class="line">logging.basicConfig(level=logging.INFO)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">myPythonLayer</span><span class="params">(caffe.Layer)</span>:</span></div><div class="line">    <span class="string">"""</span></div><div class="line">    reshape images</div><div class="line">    """</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span><span class="params">(self, bottom, top)</span>:</span></div><div class="line">        params_str = self.param_str.split(<span class="string">','</span>)</div><div class="line">        params = [yaml.load(item) <span class="keyword">for</span> item <span class="keyword">in</span> params_str] <span class="comment">#2</span></div><div class="line">        <span class="keyword">print</span> params</div><div class="line">        self.source = params[<span class="number">0</span>][<span class="string">'source_dir'</span>]</div><div class="line">        self.target_size = params[<span class="number">1</span>][<span class="string">'target_size'</span>]</div><div class="line">        self.batch_size = params[<span class="number">2</span>][<span class="string">'batch_size'</span>]<span class="comment">#3</span></div><div class="line">        self.batch_loader = BatchLoader(source_dir=self.source, target_size=self.target_size)</div><div class="line">        <span class="keyword">print</span> <span class="string">'Parameter batch_size:&#123;&#125;\n'</span> \</div><div class="line">              <span class="string">'source_dir:&#123;&#125;\n'</span> \</div><div class="line">              <span class="string">'target_size:&#123;&#125;'</span>.format(self.batch_size, self.source, self.target_size)</div><div class="line">        top[<span class="number">0</span>].reshape(self.batch_size, self.target_size, self.target_size, <span class="number">3</span>)</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reshape</span><span class="params">(self, bottom, top)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span><span class="params">(self, bottom, top)</span>:</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(self.batch_size):</div><div class="line">            top[<span class="number">0</span>].data[i, ...] = self.batch_loader.next_batch()</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">backward</span><span class="params">(self, bottom, propagate_down, top)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BatchLoader</span><span class="params">(object)</span>:</span></div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, source_dir, target_size)</span>:</span></div><div class="line">    self.cur = <span class="number">0</span></div><div class="line">    self.target_size = target_size</div><div class="line">    self.indexlist = glob.glob(source_dir+ <span class="string">'/*.jpg'</span>)<span class="comment">#4</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_batch</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.cur == len(self.indexlist):</div><div class="line">            self.cur = <span class="number">0</span></div><div class="line">            shuffle(self.indexlist)</div><div class="line">        item = self.indexlist[self.cur]</div><div class="line">        img_tmp = cv2.imread(item)</div><div class="line">        img_tmp = cv2.resize(src=img_tmp, dsize=(self.target_size, self.target_size))</div><div class="line">        self.cur += <span class="number">1</span></div><div class="line">        logging.info(<span class="string">'load &#123;&#125; images'</span>.format(self.cur))</div><div class="line">        <span class="keyword">return</span> img_tmp</div></pre></td></tr></table></figure>
<p>​    <strong>代码解释：</strong>#1 处是脚本的名字，这个名字在网络定义文件prototxt中会用到。</p>
<p>​               #2 处的yaml的使用是解析str。<code>str</code>必须以空格间隔，比如”‘batch_size’: 50”, ‘batch_size’: 与50以空格间           隔，反之会报错，这里因为有多个,我不会解析多个对，因此提前将其<code>split</code>,分而治之。</p>
<p>​              #3处的参数的顺序很重要，网络定义的prototxt的参数的顺序要根据这个来。</p>
<p>​              #4处的glob.glob(source_dir+ ‘/*.jpg’)返回的是一个list,是source_dir文件夹下的所有jpg文件的绝对路径。</p>
<p>​    <strong>代码位置</strong>：一般我写的Python层都会放在caffe-master/Python/caffe文件夹下面。这样可以直接找到。</p>
<p>(有时候可能找不到你写的这个新的层，那么你可以添加如下代码：)</p>
<p>import sys</p>
<p>sys.path.append(‘存放模块的文件夹’)</p>
<p>上面这段代码的意思就是将该模块放到PATHONPATH中</p>
<p>​    <strong>代码格式</strong>：</p>
<p>​                        class myPythonLayer(caffe.Layer):</p>
<p>​                            def setup(self, bottom, top):</p>
<p>​                            def reshape(self, bottom, top):</p>
<p>​                            def forward(self, bottom, top):</p>
<p>​                            def backward(self, bottom, propagate, top):</p>
<p>可以看到新层是继承caffe.Layer的，这是必须的。同时，大部分层包含四个方法，分别是setup, reshape, forward, backward.这四个函数。setup是对层的初始化过程,当层被调用的时候，会调用方法forward.</p>
<ul>
<li><p>top必须被reshape,否则在blob.cpp中的CHECK(data_)的报错。</p>
</li>
<li><p>forward应该是必须的。但是backward可以不是必须的。因为网络必须要有前向操作但是可以没有反向传播。</p>
</li>
<li><p>注意forward和backward 两个方法的参数</p>
<p>​</p>
</li>
</ul>
<h2 id="步骤二：生成prototxt"><a href="#步骤二：生成prototxt" class="headerlink" title="步骤二：生成prototxt"></a>步骤二：生成prototxt</h2><p>本来可以用Python直接生成prototxt的。但是我这里遇到了带你问题，我这里还是直接给出prototxt吧。下次博客再给出Python代码生成prototxt的方法吧。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#file_name = mylayer.prototxt</span></div><div class="line">layer&#123;</div><div class="line">name:<span class="string">'mylayer'</span></div><div class="line">type:<span class="string">'Python'</span></div><div class="line">top:<span class="string">'images'</span></div><div class="line">python_param&#123;</div><div class="line">    module:<span class="string">'MyPythonLayer'</span></div><div class="line">    layer:<span class="string">'myPythonLayer'</span></div><div class="line">    param_str:<span class="string">"'source_dir': '/home/amax/cqs/caffe-master/example/Cqs/data','target_size': 100,'batch_size': 200"</span></div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>解释：</strong></p>
<ol>
<li>我们用Python写的层的type都是’python’.</li>
<li>pathon_param要给出模块的名字，也就是我们写的新层的文件的名字，而layer就是我们的新层的名字。这里要注意param_str的顺序。</li>
</ol>
<h2 id="步奏三：调用运行"><a href="#步奏三：调用运行" class="headerlink" title="步奏三：调用运行"></a>步奏三：调用运行</h2><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">！<span class="comment">#-*- coding: utf-8 -*-</span></div><div class="line">author = Cqs</div><div class="line"></div><div class="line"><span class="keyword">from</span> future <span class="keyword">import</span> print_function</div><div class="line"><span class="keyword">import</span> caffe</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">    net = caffe.Net(<span class="string">'mylayer.prototxt'</span>, caffe.TEST)</div><div class="line">    net.forward()</div><div class="line">    images = net.blobs[<span class="string">'images'</span>].data</div><div class="line">    print(images.shape)</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight"><table><tr><td class="code"><pre><div class="line">/usr/bin/python2.7 /home/amax/cqs/caffe-master/examples/Cqs/test.py</div><div class="line">WARNING: Logging before InitGoogleLogging() is written to STDERR</div><div class="line">[&#123;'source_dir': '/home/amax/cqs/caffe-master/examples/Cqs/data'&#125;, &#123;'batch_size': 200&#125;, &#123;'target_size': 100&#125;]</div><div class="line">I0322 13:53:32.455627 36217 net.cpp:51] Initializing net from parameters: </div><div class="line">Parameter batch_size:200</div><div class="line">state &#123;</div><div class="line">source_dir:/home/amax/cqs/caffe-master/examples/Cqs/data</div><div class="line">  phase: TEST</div><div class="line">target_size:100</div><div class="line">  level: 0</div><div class="line">&#125;</div><div class="line">layer &#123;</div><div class="line">  name: "mylayer"</div><div class="line">  type: "Python"</div><div class="line">  top: "images"</div><div class="line">  python_param &#123;</div><div class="line">module: "MyPythonLayer"</div><div class="line">layer: "myPythonLayer"</div><div class="line">param_str: " \'source_dir\': /home/amax/cqs/caffe-master/examples/Cqs/data, \'batch_size\': 200, \'target_size\': 100 "</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">I0322 13:53:32.455687 36217 layer_factory.hpp:77] Creating layer mylayer</div><div class="line">I0322 13:53:32.456166 36217 net.cpp:84] Creating Layer mylayer</div><div class="line">I0322 13:53:32.456177 36217 net.cpp:380] mylayer -&gt; images</div><div class="line">I0322 13:53:32.457883 36217 net.cpp:122] Setting up mylayer</div><div class="line">I0322 13:53:32.457898 36217 net.cpp:129] Top shape: 200 100 100 3 (6000000)</div><div class="line">I0322 13:53:32.457903 36217 net.cpp:137] Memory required for data: 24000000</div><div class="line">I0322 13:53:32.457908 36217 net.cpp:200] mylayer does not need backward computation.</div><div class="line">I0322 13:53:32.457912 36217 net.cpp:242] This network produces output images</div><div class="line">I0322 13:53:32.457917 36217 net.cpp:255] Network initialization done.</div><div class="line">INFO:root:load /home/amax/cqs/caffe-master/examples/Cqs/data/000001.jpg images</div><div class="line">INFO:root:load /home/amax/cqs/caffe-master/examples/Cqs/data/000002.jpg images</div><div class="line">INFO:root:load /home/amax/cqs/caffe-master/examples/Cqs/data/000003.jpg images</div><div class="line">.................................196个输出.............................................</div><div class="line">INFO:root:load /home/amax/cqs/caffe-master/examples/Cqs/data/000015.jpg images</div><div class="line">(200, 100, 100, 3)</div><div class="line">Process finished with exit code 0</div></pre></td></tr></table></figure>
<p><strong>Reference</strong></p>
<p><a href="https://saicoco.github.io/pycaffe/" target="_blank" rel="external">参考一</a></p>
<p><a href="http://www.voidcn.com/blog/eagelangel/article/p-6119936.html" target="_blank" rel="external">参考二</a></p>
<p><a href="http://pyyaml.org/wiki/PyYAMLDocumentation" target="_blank" rel="external">参考三</a></p>
<p><a href="http://blog.xiayf.cn/2013/01/26/python-string-format/" target="_blank" rel="external">参考四</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/22/Python写caffe层/" data-id="cj0kkdjym00054sflfztzyaqn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-caffe/">python, caffe</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-test" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/21/test/" class="article-date">
  <time datetime="2017-03-21T10:46:51.000Z" itemprop="datePublished">2017-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/21/test/">Test</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>就为了做个测试。</p>
<p><img src="test/test.jpg" alt="测试"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/21/test/" data-id="cj0kkdjyy000g4sfle7zrtn1q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/test/">test</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/21/hello-world/" class="article-date">
  <time datetime="2017-03-21T09:30:03.296Z" itemprop="datePublished">2017-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/21/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/21/hello-world/" data-id="cj0kkdjys000a4sflhlm8y7ad" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-python-random" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/21/python-random/" class="article-date">
  <time datetime="2017-03-21T09:16:09.028Z" itemprop="datePublished">2017-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/21/python-random/">Python-Random</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近在使用python的随机数，所以总结一下。</p>
<h1 id="导入包"><a href="#导入包" class="headerlink" title="导入包"></a>导入包</h1><p>​    <strong>import random</strong></p>
<h1 id="具体的函数"><a href="#具体的函数" class="headerlink" title="具体的函数"></a>具体的函数</h1><ul>
<li><p>random.random() </p>
<p>随机生成一个0-1之间浮点数</p>
</li>
<li><p>random.uniform(a, b)</p>
<p>生成[a, b]之间的均匀分布的随机数</p>
</li>
<li><p>random.randint(a, b)</p>
<p>生成[a, b]之间的随机的整数</p>
</li>
<li><p>random.randrange(start, stop, step)</p>
<p>生成[start : step : stop]这个数列中的随机一个数。</p>
<p>特例：若step为偶数，start为偶数，则随机生成指定范围的偶数；若start为奇数，则生成指定范围内的奇数</p>
</li>
<li><p>random.choice(sequence)</p>
<p>从序列sequence中随机选择一个元素</p>
</li>
<li><p>random.shuffle(X)</p>
<p>打乱列表X的元素顺序</p>
</li>
<li><p>random.sample(X, k)</p>
<p>从列表X中随机选取K个数</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/21/python-random/" data-id="cj0kkdjyv000c4sflbkf68gfm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-random/">python,  random</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python-to-exe" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/21/python-to-exe/" class="article-date">
  <time datetime="2017-03-21T08:25:32.000Z" itemprop="datePublished">2017-03-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/21/python-to-exe/">Python创建exe文件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h1><p>这两天用Python写了一个图片打标签的工具，然后将它包装成了exe文件。在这里记录一下，生成exe的方法。</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>py2exe是一个将Python脚本转化成windows上的可独立执行的程序(*.exe)的工具。这样我们就可以不用装Python而在windows上运行这个可执行程序。</p>
<p>py2exe已经被用于创建wxPython,Tkinter,Pmw,PyGTK,pygame,win32com client server。和其他的独立程序。py2exe是发布在开源许可证下的。</p>
<h2 id="安装py2exe"><a href="#安装py2exe" class="headerlink" title="安装py2exe"></a>安装py2exe</h2><p>从<a href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#imread" target="_blank" rel="external">网站</a>可以下载到py2exe‑0.6.10a1‑cp27‑none‑win_amd64.whl。然后可以使用pip install 安装。</p>
<h2 id="py2exe的使用"><a href="#py2exe的使用" class="headerlink" title="py2exe的使用"></a>py2exe的使用</h2><p>假设我们有一个脚本：image_labeling.py的python脚本。现在打算将他们转化为exe文件。首先创建一个mysetup.py的脚本。如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># mysetup.py</span></div><div class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup</div><div class="line"><span class="keyword">import</span> py2exe</div><div class="line">setup(console=[<span class="string">"image_labeling.py"</span>])</div></pre></td></tr></table></figure>
<p>运行方法：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">python mysetup.py py2exe</div></pre></td></tr></table></figure>
<p><img src="python-to-exe/exe.png" alt="生成的文件"></p>
<p><img src="python-to-exe/ruanjian.png" alt="软件界面V1"></p>
<p>上面的命令执行后将产生一个名为dist的子目录，其中包含了myscript.exe, python24.dll, library.zip这些文件。<br>如果你的myscript.py脚本中用了已编译的C扩展模块，那么这些模块也会被拷贝在个子目录中，同样，所有的dll文件在运行时都是需要的，除了系统的dll文件。<br>dist子目录中的文件包含了你的程序所必须的东西，你应将这个子目录中的所有内容一起发布。</p>
<p>默认情况下，py2exe在目录dist下创建以下这些必须的文件：<br>1、一个或多个exe文件。<br>2、python##.dll。<br>3、几个.pyd文件，它们是已编译的扩展名，它们是exe文件所需要的；加上其它的.dll文件，这些.dll是.pyd所需要的。<br>4、一个library.zip文件，它包含了已编译的纯的python模块如.pyc或.pyo<br>上面的mysetup.py创建了一个控制台的myscript.exe程序，如果你要创建一个图形用户界的程序，那么你只需要将mysetup.py中的console=[“myscript.py”]替换为windows=[“myscript.py”]既可。</p>
<p>py2exe一次能够创建多个exe文件，你需要将这些脚本文件的列表传递给console或windows的关键字参数。如果你有几个相关联的脚本，那么这是很有用的。<br>运行下面个命令，将显示py2exe命令的所有命令行标记。<br><code>python mysetup.py py2exe --help</code></p>
<h2 id="指定额外的文件"><a href="#指定额外的文件" class="headerlink" title="指定额外的文件"></a>指定额外的文件</h2><p>一些应用程序在运行时需要额外的文件，诸如配置文件、字体、位图。<br>如果在安装脚本中用data_files可选项指定了那些额外的文件，那么py2exe能将这些文件拷贝到dist子目录中。data_files应包含一个元组(target-dir, files)列表，其中的files是这些额外的文件的列表。<br>示例如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment"># mysetup.py</span></div><div class="line"><span class="keyword">from</span> distutils.core <span class="keyword">import</span> setup</div><div class="line"><span class="keyword">import</span> glob</div><div class="line"><span class="keyword">import</span> py2exe</div><div class="line"></div><div class="line">setup(console=[<span class="string">"myscript.py"</span>],</div><div class="line">       data_files=[(<span class="string">"bitmaps"</span>,</div><div class="line">                    [<span class="string">"bm/large.gif"</span>, <span class="string">"bm/small.gif"</span>]),</div><div class="line">                   (<span class="string">"fonts"</span>,</div><div class="line">                    glob.glob(<span class="string">"fonts\\*.fnt"</span>))],</div></pre></td></tr></table></figure>
<p>说明：data_files选项将创建一个子目录dist\bitmaps，其中包含两个.gif文件；一个子目录dist\fonts，其中包含了所有的.fnt文件。</p>
<h2 id="Windows-NT-services"><a href="#Windows-NT-services" class="headerlink" title="Windows NT services"></a>Windows NT services</h2><p>你可以通过传递一个service关键字参数给setup函数来建造Windows NT services<br>,这个service参数的值必须是一个Python模块名(包含一service类)的列表。<br>示例如下：</p>
<p><code>mysetup.py</code></p>
<p><code>from distutils.core import setup</code><br><code>import py2exe</code></p>
<p><code>setup(service=[&quot;MyService&quot;])</code><br>所建造的可执行的service是可以通过在其后跟一定的命令行参数标记来自行安装和卸载的。你可以通过在这个可执行的service(exe)后跟一-help参数来得到更多的帮助。</p>
<h2 id="COM-servers"><a href="#COM-servers" class="headerlink" title="COM servers"></a>COM servers</h2><p>你可以通过传递一个com_server 关键字参数给setup函数来建造Windows NT services<br>,这个service参数的值必须是一个Python模块名(包含一个或多个COM server 类)的列表。<br>示例如下：</p>
<p><code>mysetup.py</code></p>
<p><code>from distutils.core import setup</code><br><code>import py2exe</code></p>
<p><code>setup(com_server=[&quot;win32com.server.interp&quot;])</code><br>默认情况下，DLL和EXE servers被建造，你不需要它们的话你可以简单的删除它们。</p>
<h2 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h2><p><a href="http://www.cnblogs.com/rj81/p/5495191.html" target="_blank" rel="external">参考</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/21/python-to-exe/" data-id="cj0kkdjyw000e4sfl416tpwj4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-exe/">python, exe</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Genetic-Algorithms" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/19/Genetic-Algorithms/" class="article-date">
  <time datetime="2017-03-19T05:39:08.000Z" itemprop="datePublished">2017-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/19/Genetic-Algorithms/">Genetic_Algorithms</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h1><p>因为打算用遗传算法来优化深度神经网络的训练过程，所以，这两天熟悉了一下遗传算法(Genetic algorithms)，这里就来简要的记录一下这两天的学习。</p>
<h1 id="算法"><a href="#算法" class="headerlink" title="算法"></a><a href="https://zh.wikipedia.org/wiki/%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95" target="_blank" rel="external">算法</a></h1><p>遗传算法(genetic algorithm (GA))是计算机数学中用于解决最优化的搜索算法，是进化算法的一种。</p>
<p>遗传算法通常实现方式为一种计算机模拟。对于一个最优化问题，一定数量的候选解(个体)可以抽象表示为染色体，使得种群向更好的解进化。传统上，解用二进制表示(0和1的串)，但是也可以用其他的表示方法。进化从完全随机个体的种群开始，之后一代一代发生。在每一代中评价整个种群的适应度，从当前种群中随机选择多个个体(基于他们的适应度)。通过自然选择和突变产生新的生命种群，该种群在算法的下一次迭代中成为当前种群。</p>
<h2 id="算法流程图"><a href="#算法流程图" class="headerlink" title="算法流程图"></a>算法流程图</h2><p><img src="Genetic-Algorithms/flow_chart.jpg" alt="算法流程图"></p>
<h2 id="算法细节"><a href="#算法细节" class="headerlink" title="算法细节"></a>算法细节</h2><ul>
<li>编码–&gt;创造染色体</li>
<li>个体–&gt;种群</li>
<li>适应度函数</li>
<li>遗传算子<ul>
<li>选择</li>
<li>交叉</li>
<li>变异</li>
</ul>
</li>
<li>运行参数<ul>
<li>是否选择精英操作</li>
<li>种群大小</li>
<li>染色体长度</li>
<li>最大迭代次数</li>
<li>交叉概率</li>
<li>变异概率</li>
</ul>
</li>
</ul>
<h3 id="编码与解码"><a href="#编码与解码" class="headerlink" title="编码与解码"></a>编码与解码</h3><p>实现遗传算法的第一步就是明确求解问题的解码和编码方式</p>
<p>对于函数优化问题，一般有两种编码方式，各具优缺点</p>
<ul>
<li>实数编码： 直接用实数表示基因，容易理解且不需要解码过程，但是容易过早收敛，从而陷入局部最优</li>
<li>二进制编码： 稳定性高，种群多样性大，但需要的存储空间大，需要解码且难以理解</li>
</ul>
<h3 id="个体与种群"><a href="#个体与种群" class="headerlink" title="个体与种群"></a>个体与种群</h3><p>染色体表达了某种特征，这种特征的载体，称为个体。</p>
<h3 id="适应度函数"><a href="#适应度函数" class="headerlink" title="适应度函数"></a>适应度函数</h3><p>遗传算法中，一个个体的好坏适应度值来评价。</p>
<p>适应度值越大，解的质量越高。</p>
<p>适应度函数是遗传算法进化的驱动力，也是进行自然选择的唯一标准，他的设计应结合求解问题本身的要求而定。</p>
<h3 id="遗传算子"><a href="#遗传算子" class="headerlink" title="遗传算子"></a>遗传算子</h3><p>我们希望有这样一个种群，它所包含的个体所对应的函数的最值，但是这个种群一开始可能不那么优秀，因为个体的染色体串是随机生成的。</p>
<p>如何让种群变得优秀呢？</p>
<p>不断的进化。</p>
<p>每一次进化都尽可能保留种群中的优秀个体，淘汰掉不理想的个体，并且在优秀个体之间进行染色体交叉，有些个体还可能出现变异。</p>
<p>种群的每一次进化，都会产生一个最优个体。种群所有世代的最优个体，可能就是函数最值对应的定义域中的点。</p>
<p>如果种群无休止地进化，那总能找到最好的解。但实际上，我们的时间有限，通常在得到一个看上去不错的解时，便终止了进化。</p>
<p>对于给定的种群，如何赋予它<strong>进化</strong>的能力呢？</p>
<ul>
<li>首先是<strong>选择</strong>(selection)<ul>
<li>选择操作是从前代种群中选择<strong><em>多对</em></strong>较优个体，一对较优个体称之为一对父母，让父母们将它们的基因传递到下一代，直到下一代个体数量达到种群数量上限</li>
<li>在选择操作前，将种群中个体按照适应度从小到大进行排列</li>
<li>采用轮盘赌选择方法（当然还有很多别的选择方法），各个个体被选中的概率与其适应度函数值大小成正比</li>
<li>轮盘赌选择方法具有随机性，在选择的过程中可能会丢掉较好的个体，所以可以使用精英机制，将前代最优个体直接选择</li>
</ul>
</li>
<li>其次是<strong>交叉</strong>(crossover)<ul>
<li>两个待交叉的不同的染色体(父母)根据交叉概率(cross_rate)按某种方式交换其部分基因</li>
<li>采用单点交叉法，也可以使用其他交叉方法</li>
</ul>
</li>
<li>最后是<strong>变异</strong>(mutation)<ul>
<li>染色体按照变异概率(mutate_rate)进行染色体的变异</li>
<li>采用单点变异法，也可以使用其他变异方法</li>
</ul>
</li>
</ul>
<p>一般来说，交叉概率(cross_rate)比较大，变异概率(mutate_rate)极低。像求解函数最大值这类问题，</p>
<p>因为遗传算法相信2条优秀的父母染色体交叉更有可能产生优秀的后代，而变异的话产生优秀后代的可能性极低，不过也有存在可能一下就变异出非常优秀的后代。这也是符合自然界生物进化的特征的。</p>
<h2 id="待求解问题"><a href="#待求解问题" class="headerlink" title="待求解问题"></a>待求解问题</h2><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">求解函数 f(x) = x + <span class="number">10</span>*sin(<span class="number">5</span>*x) + <span class="number">7</span>*cos(<span class="number">4</span>*x) 在区间[<span class="number">0</span>,<span class="number">9</span>]的最大值。</div></pre></td></tr></table></figure>
<p><img src="Genetic-Algorithms/function.png" alt="function"></p>
<h3 id="编码和解码"><a href="#编码和解码" class="headerlink" title="编码和解码"></a>编码和解码</h3><p>假如设定求解的精度为小数点后4位，可以将x的解空间划分为 <code>(9-0)×(1e+4)=90000</code>个等分。</p>
<p><code>2^16&lt;90000&lt;2^17</code>，需要17位二进制数来表示这些解。换句话说，一个解的编码就是一个17位的二进制串。</p>
<p>一开始，这些二进制串是随机生成的。</p>
<p>一个这样的二进制串代表一条染色体串，这里染色体串的长度为17。</p>
<p>对于任何一条这样的染色体chromosome，如何将它复原(解码)到[0,9]这个区间中的数值呢？</p>
<p>对于本问题，我们可以采用以下公式来解码：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">x = <span class="number">0</span> + decimal(chromosome)×(<span class="number">9</span><span class="number">-0</span>)/(<span class="number">2</span>^<span class="number">17</span><span class="number">-1</span>)</div></pre></td></tr></table></figure>
<p>decimal( ): 将二进制数转化为十进制数</p>
<p>一般化解码公式：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">f(x), x∈[lower_bound, upper_bound]</div><div class="line">x = lower_bound + decimal(chromosome)×(upper_bound-lower_bound)/(<span class="number">2</span>^chromosome_size<span class="number">-1</span>)</div></pre></td></tr></table></figure>
<p>lower_bound: 函数定义域的下限<br>upper_bound: 函数定义域的上限<br>chromosome_size: 染色体的长度</p>
<p>通过上述公式，我们就可以成功地将二进制染色体串解码成[0,9]区间中的十进制实数解。</p>
<h3 id="个体与种群-1"><a href="#个体与种群-1" class="headerlink" title="个体与种群"></a>个体与种群</h3><p>本次实验所要解决的一元函数最大值求解问题，个体可以用上一节构造的染色体表示，一个个体里有一条染色体。</p>
<p>许多这样的个体组成了一个种群，其含义是一个一维点集(x轴上[0,9]的线段)。</p>
<h3 id="适应度函数-1"><a href="#适应度函数-1" class="headerlink" title="适应度函数"></a>适应度函数</h3><p>在本问题中，f(x)就是适应度函数。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="comment">#-*- coding=utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> math</div><div class="line"><span class="keyword">import</span> random</div><div class="line"><span class="keyword">import</span> operator</div><div class="line"><span class="keyword">import</span> time</div><div class="line"></div><div class="line"><span class="comment">##求解函数 f(x) = x + 10*sin(5*x) + 7*cos(4*x) 在区间[0,9]的最大值。</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">GA</span><span class="params">()</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, length, count)</span>:</span></div><div class="line">        <span class="comment"># 染色体的长度</span></div><div class="line">        self.length = length</div><div class="line">        <span class="comment"># 种群中染色体的数量</span></div><div class="line">        self.count = count</div><div class="line">        <span class="comment"># 随机生成及初始种群</span></div><div class="line">        self.population = self.gen_population(length, count)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">evolve</span><span class="params">(self, retain_rate=<span class="number">0.2</span>, random_select_rate=<span class="number">0.5</span>, mutation_rate=<span class="number">0.01</span>)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        进化</div><div class="line">        对当前一代种群依次进行选择，交叉并生成新一代种群，然后对新一代的种群进行变异</div><div class="line">        :param retain_rate:当前一代保留的概率</div><div class="line">        :param random_select_rate:随机选择适应度虽然小但是幸存下来的概率</div><div class="line">        :param mutation_rate: 变异的概率</div><div class="line">        """</div><div class="line">        parents = self.selection(retain_rate, random_select_rate)</div><div class="line">        self.crossover(parents)</div><div class="line">        self.mutation(mutation_rate)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">selection</span><span class="params">(self, retain_rate, random_select_rate)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        选择</div><div class="line">        先对适应度从小到大排序，选出存活的染色体</div><div class="line">        再进行随机选择，选出适应度虽然小，但是幸存下来的个体</div><div class="line">        :param retain_rate: 当前一代保留的概率</div><div class="line">        :param random_select_rate: 随机选择适应度虽然小但是幸存下来的概率</div><div class="line">        :return: 返回留下来交配的染色体</div><div class="line">        """</div><div class="line">        <span class="comment">#对适应度从小到大排序，选出存活的染色体</span></div><div class="line">        grated = [(self.fitness(chromosome),chromosome) <span class="keyword">for</span> chromosome <span class="keyword">in</span> self.population]</div><div class="line">        grated = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> sorted(grated, reverse=<span class="keyword">True</span>)]</div><div class="line"></div><div class="line">        <span class="comment">#选出适应性强的染色体</span></div><div class="line">        retain_length = int(len(grated) * retain_rate)</div><div class="line">        parents = grated[:retain_length] <span class="comment"># 选择前retain_length个元素</span></div><div class="line">        <span class="comment">#选出适应性不强，但是幸存下来的染色体</span></div><div class="line">        <span class="keyword">for</span> chromosome <span class="keyword">in</span> grated[retain_length:]:</div><div class="line">            <span class="keyword">if</span> random.random() &lt; random_select_rate:</div><div class="line">                parents.append(chromosome)</div><div class="line">        <span class="keyword">return</span> parents</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">crossover</span><span class="params">(self, parents)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        染色体的交叉，繁殖，生成新一代的种群</div><div class="line">        :param parents: 父母</div><div class="line">        :return: 新一代种群</div><div class="line">        """</div><div class="line">        <span class="comment">#新出生的孩子，最终会被加入存活下来的父母之中，形成新一代的种群。</span></div><div class="line">        children =[]</div><div class="line">        <span class="comment">#需要繁殖的孩子的量</span></div><div class="line">        target_count = len(self.population) - len(parents)</div><div class="line">        <span class="comment">#开始根据需要的量进行繁殖</span></div><div class="line">        <span class="keyword">while</span> len(children) &lt; target_count:</div><div class="line">            male = random.randint(<span class="number">0</span>, len(parents)<span class="number">-1</span>)</div><div class="line">            female = random.randint(<span class="number">0</span>,len(parents)<span class="number">-1</span>)</div><div class="line">            <span class="keyword">if</span> male != female:</div><div class="line">                <span class="comment">#随机选择交叉点</span></div><div class="line">                cross_pos = random.randint(<span class="number">0</span>, self.length)</div><div class="line">                <span class="comment">#生成掩码，方便位操作</span></div><div class="line">                mask = <span class="number">0</span></div><div class="line">                <span class="keyword">for</span> i <span class="keyword">in</span> xrange(cross_pos):</div><div class="line">                    mask |= (<span class="number">1</span> &lt;&lt; i)</div><div class="line">                male = parents[male]</div><div class="line">                female = parents[female]</div><div class="line">                <span class="comment">#孩子将获得父亲在交叉点前的基因和母亲在交叉点后的(包括交叉点)的基因</span></div><div class="line">                child = ((male &amp; mask) | (female &amp; ~mask)) &amp; ((<span class="number">1</span> &lt;&lt; self.length) <span class="number">-1</span>)</div><div class="line">                children.append(child)</div><div class="line">        <span class="comment">#经过繁殖后，孩子和父母的数量与原始种群的数量相等，在这里可以更新种群</span></div><div class="line">        self.population = parents + children</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mutation</span><span class="params">(self, rate)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        变异</div><div class="line">        对种群中的所有个体，随机改变某个个体中的某个基因</div><div class="line">        :param rate:</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(len(self.population)):</div><div class="line">            <span class="keyword">if</span> random.random() &lt; rate:</div><div class="line">                j = random.randint(<span class="number">0</span>, self.length <span class="number">-1</span>)</div><div class="line">                self.population[i] ^= <span class="number">1</span> &lt;&lt; j</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_chromosome</span><span class="params">(self, length)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        随机生成长度为length的染色体， 每个基因的取值为0或者1</div><div class="line">        这里用一个bit表示一个基因</div><div class="line">        :param length: 染色体的长度</div><div class="line">        :return: 一个长度为length的染色体，每一位为0或者1</div><div class="line">        """</div><div class="line">        chromosome = <span class="number">0</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(length):</div><div class="line">            <span class="comment"># 1 &lt;&lt; i ==&gt; 2 ^ i</span></div><div class="line">            chromosome |= (<span class="number">1</span> &lt;&lt; i) *  random.randint(<span class="number">0</span>, <span class="number">1</span>) <span class="comment">#x |= 5 ==&gt; x = x | 5</span></div><div class="line">        <span class="keyword">return</span> chromosome</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gen_population</span><span class="params">(self, length, count)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        获取初始种群(一个含有count个长度为length的染色体列表)</div><div class="line">        :param length: 染色体的长度</div><div class="line">        :param count: 种群的染色体数量</div><div class="line">        :return: 一个含有count个长度为length的染色体列表</div><div class="line">        """</div><div class="line">        <span class="keyword">return</span> [self.gen_chromosome(length) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(count)]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fitness</span><span class="params">(self, chromosome)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        计算适应度， 将染色体解码为0~9之间的数字，带入函数计算</div><div class="line">        以为求解最大值，所以数值越大，适应度越高</div><div class="line">        :param chromosome: 染色体</div><div class="line">        :return: 返回适应度</div><div class="line">        """</div><div class="line">        x = self.decode(chromosome)</div><div class="line">        <span class="keyword">return</span> x + <span class="number">10</span>*math.sin(<span class="number">5</span>*x) + <span class="number">7</span>*math.cos(<span class="number">4</span>*x)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decode</span><span class="params">(self, chromosome)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        解码染色体，将二进制转化为属于[0,9]之间的额实数</div><div class="line">        :param chromosome: 二进制表达的染色体</div><div class="line">        :return: [0,9]之间的数字</div><div class="line">        """</div><div class="line">        <span class="keyword">return</span> chromosome * <span class="number">9.0</span> / (<span class="number">2</span>**self.length <span class="number">-1</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">result</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="string">"""</span></div><div class="line">        获取当前代的最优值，智力取得是函数取最大值的x的值</div><div class="line">        :return:</div><div class="line">        """</div><div class="line">        grated = [(self.fitness(chromosome), chromosome) <span class="keyword">for</span> chromosome <span class="keyword">in</span> self.population]</div><div class="line">        grated = [x[<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> sorted(grated, reverse=<span class="keyword">True</span>)]</div><div class="line"></div><div class="line">        <span class="keyword">return</span> ga.decode(grated[<span class="number">0</span>])</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__==<span class="string">'__main__'</span>:</div><div class="line">    <span class="comment">#染色体长度为17，种群数量为300</span></div><div class="line">    ga = GA(<span class="number">17</span>, <span class="number">300</span>)</div><div class="line">    </div><div class="line">    time1 = time.time()</div><div class="line">    <span class="comment">#200次进化diedai</span></div><div class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> xrange(<span class="number">200</span>):</div><div class="line">        ga.evolve()</div><div class="line"></div><div class="line">    time2 = time.time()</div><div class="line">    <span class="keyword">print</span> <span class="string">"结果是： "</span>, ga.result()</div><div class="line">    <span class="keyword">print</span> <span class="string">"运行时间是："</span>, time2 - time1</div></pre></td></tr></table></figure>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p>结果是：  7.85748182283<br>运行时间是： 0.155000209808</p>
<h1 id="写在后面的话"><a href="#写在后面的话" class="headerlink" title="写在后面的话"></a>写在后面的话</h1><p>现实问题转化到遗传算法是一个难点，也就是如何有效地将现实问题映射到遗传算法个个体上，完成了这一步，后面的三个算子也就是按部就班的事情了。</p>
<p>遗传算法中有很多参数，比如说，初始种群的数量，交叉概率，变异概率，进化代数等等，这些参数影响算法的收敛速度和收敛值。</p>
<p>遗传算法是一种仿生算法，类似的算法还有模拟退火算法、粒子群算法、蚁群算法、禁忌搜索，统称为元启发式算法（Meta-heuristic algorithms）这类算法得益于自然界现象的启发，而不是像确定性算法那样的数字论证。</p>
<h2 id="reference："><a href="#reference：" class="headerlink" title="reference："></a>reference：</h2><p><a href="https://www.zhihu.com/question/23293449" target="_blank" rel="external">参考一</a></p>
<p><a href="https://zh.wikipedia.org/wiki/%E9%81%97%E4%BC%A0%E7%AE%97%E6%B3%95" target="_blank" rel="external">参考二</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/19/Genetic-Algorithms/" data-id="cj0kkdjyf00044sfl1qahghma" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-Algorithms/">python, Algorithms</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python-PIL-matplotlib" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/17/python-PIL-matplotlib/" class="article-date">
  <time datetime="2017-03-17T07:36:17.000Z" itemprop="datePublished">2017-03-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/17/python-PIL-matplotlib/">python_PIL_matplotlib</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PIL"><a href="#PIL" class="headerlink" title="PIL"></a>PIL</h1><p>PIL的全称为Python Imaging Library, 是Python中的一个免费的图像处理模块。</p>
<h3 id="导入包"><a href="#导入包" class="headerlink" title="导入包"></a>导入包</h3><p><code>from PIL import Image</code></p>
<h2 id="图片读取"><a href="#图片读取" class="headerlink" title="图片读取"></a>图片读取</h2><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>) <span class="comment"># 返回一个Image图像对象</span></div><div class="line"><span class="keyword">print</span> img</div><div class="line"></div><div class="line"><span class="comment">#结果</span></div><div class="line">&lt;PIL.JpegImagePlugin.JpegImageFile image mode=RGB size=<span class="number">353</span>x500 at <span class="number">0x2945A90</span>&gt;</div></pre></td></tr></table></figure>
<h2 id="图像显示"><a href="#图像显示" class="headerlink" title="图像显示"></a>图像显示</h2><h3 id="导入包-1"><a href="#导入包-1" class="headerlink" title="导入包"></a>导入包</h3><p><code>import matplotlib.pyplot as plt</code></p>
<p>代码段：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line">fig, ax = plt.subplots(figsize=(<span class="number">5</span>, <span class="number">5</span>)) <span class="comment">#定义一个12*12 大小的画板</span></div><div class="line">ax.imshow(img) <span class="comment">#显示图片，此时图片还在内存中</span></div><div class="line">plt.axis(<span class="string">'off'</span>) <span class="comment">#消除横纵坐标</span></div><div class="line">ax.set_title(<span class="string">'000001.jpg'</span>)<span class="comment">#设置一个标题</span></div><div class="line">plt.show()<span class="comment">#显示图片，要不然没有办法显示</span></div></pre></td></tr></table></figure>
<h3 id="图片显示结果"><a href="#图片显示结果" class="headerlink" title="图片显示结果"></a>图片显示结果</h3><p><img src="python-PIL-matplotlib/图片显示.png" alt="图片显示"></p>
<h2 id="图片保存"><a href="#图片保存" class="headerlink" title="图片保存"></a>图片保存</h2><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>) <span class="comment"># 返回一个Image图像对象</span></div><div class="line">img_save = img.save(<span class="string">'000001_save.png'</span>)<span class="comment">#保存图片并且同时改变图片的格式</span></div></pre></td></tr></table></figure>
<h2 id="图片转化为灰度图"><a href="#图片转化为灰度图" class="headerlink" title="图片转化为灰度图"></a>图片转化为灰度图</h2><figure class="highlight python"><table><tr><td class="code"><pre><div class="line">img_save = img.save(<span class="string">'000001_save.png'</span>)</div><div class="line">img_gray = img.convert(<span class="string">"L"</span>)</div><div class="line"><span class="keyword">print</span> img_gray</div><div class="line"></div><div class="line"><span class="comment">#结果</span></div><div class="line">&lt;PIL.Image.Image image mode=L size=<span class="number">353</span>x500 at <span class="number">0x264F780</span>&gt;</div></pre></td></tr></table></figure>
<h3 id="灰度图片显示"><a href="#灰度图片显示" class="headerlink" title="灰度图片显示"></a>灰度图片显示</h3><p><img src="python-PIL-matplotlib/灰度图.png" alt="灰度图片"></p>
<h2 id="Image对象和图像矩阵之间转换"><a href="#Image对象和图像矩阵之间转换" class="headerlink" title="Image对象和图像矩阵之间转换"></a>Image对象和图像矩阵之间转换</h2><h3 id="导入包-2"><a href="#导入包-2" class="headerlink" title="导入包"></a>导入包</h3><p><code>import numpy as np</code></p>
<h3 id="Image对象转化成图像矩阵"><a href="#Image对象转化成图像矩阵" class="headerlink" title="Image对象转化成图像矩阵"></a>Image对象转化成图像矩阵</h3><p>Image对象转化成图像矩阵只要将Image对象作为<code>numpy.array()</code>参数即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img_array = np.array(img)</div><div class="line"><span class="keyword">print</span> img_array</div><div class="line"></div><div class="line"><span class="comment">#结果</span></div><div class="line">[[[  <span class="number">1</span>   <span class="number">1</span>   <span class="number">0</span>]</div><div class="line">  [  <span class="number">1</span>   <span class="number">1</span>   <span class="number">0</span>]</div><div class="line">  [  <span class="number">1</span>   <span class="number">1</span>   <span class="number">0</span>]</div><div class="line"> <span class="comment">#忽略</span></div><div class="line">  [ <span class="number">31</span>  <span class="number">60</span> <span class="number">116</span>]</div><div class="line">  [ <span class="number">32</span>  <span class="number">58</span> <span class="number">119</span>]</div><div class="line">  [ <span class="number">26</span>  <span class="number">50</span> <span class="number">120</span>]]]</div></pre></td></tr></table></figure>
<h3 id="图像矩阵转化为Image对象"><a href="#图像矩阵转化为Image对象" class="headerlink" title="图像矩阵转化为Image对象"></a>图像矩阵转化为Image对象</h3><p>图像矩阵转化成Image对象通过<code>Image</code>模块的<code>fromarray()</code>方法。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>) <span class="comment"># 返回一个Image图像对象</span></div><div class="line">img_array = np.array(img)</div><div class="line"></div><div class="line">img_array = <span class="number">255</span> - img_array</div><div class="line">img_neg = Image.fromarray(img_array)</div></pre></td></tr></table></figure>
<p><img src="python-PIL-matplotlib/反向图.png" alt="将矩阵转化为Image对象"></p>
<h2 id="创建缩略图"><a href="#创建缩略图" class="headerlink" title="创建缩略图"></a>创建缩略图</h2><p>创建图像缩略图可以通过Image的<code>thumbnail()</code>方法，参数传入一个元组，指明缩略图的大小，如<code>thumbnail((128,128))</code></p>
<h2 id="图片截取"><a href="#图片截取" class="headerlink" title="图片截取"></a>图片截取</h2><p>截取图像中的一部分，并将这一部分作为一个新的Image对象。<br>截取区域的方法为<code>crop()</code>，参数为一个含4个元素的元组，用来指定截取区域的<strong>左上角点和右下角点</strong>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>) <span class="comment"># 返回一个Image图像对象</span></div><div class="line"></div><div class="line">box = (<span class="number">48</span>,<span class="number">240</span>,<span class="number">196</span>,<span class="number">372</span>)</div><div class="line">img_crop = img.crop(box)</div></pre></td></tr></table></figure>
<p><img src="python-PIL-matplotlib/截取图.png" alt="image_crop"></p>
<h2 id="图像的尺寸调整和旋转"><a href="#图像的尺寸调整和旋转" class="headerlink" title="图像的尺寸调整和旋转"></a>图像的尺寸调整和旋转</h2><p>尺寸调整方法为<code>resize()</code>，参数为一元组，指定调整后的大小，如<code>resize((128,128))。 图像旋转的方法为</code>rotate()<code>，参数为旋转角度（数值，单位为度）,逆时针方向，如</code>rotate(45)`</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>) <span class="comment"># 返回一个Image图像对象</span></div><div class="line"></div><div class="line">image_resize = img.resize((<span class="number">200</span>,<span class="number">200</span>))</div><div class="line">image_rotate = img.rotate(<span class="number">45</span>)</div><div class="line"></div><div class="line">fig, (ax1, ax2) = plt.subplots(<span class="number">1</span>,<span class="number">2</span>,figsize=(<span class="number">8</span>, <span class="number">8</span>)) <span class="comment">#定义一个12*12 大小的画板</span></div><div class="line"><span class="comment">#显示第一幅图片</span></div><div class="line">ax1.imshow(image_resize)</div><div class="line">ax1.axis(<span class="string">'off'</span>) <span class="comment">#消除横纵坐标</span></div><div class="line">ax1.set_title(<span class="string">'image_resize'</span>)<span class="comment">#设置一个标题</span></div><div class="line"><span class="comment">#显示第二幅图片</span></div><div class="line">ax2.imshow(image_rotate)</div><div class="line">ax2.axis(<span class="string">'off'</span>) <span class="comment">#消除横纵坐标</span></div><div class="line">ax2.set_title(<span class="string">'image_resize'</span>)<span class="comment">#设置一个标题</span></div><div class="line"></div><div class="line">plt.show()<span class="comment">#显示图片，要不然没有办法显示</span></div></pre></td></tr></table></figure>
<p><img src="python-PIL-matplotlib/resize_rotated.png" alt="resize and rotate"></p>
<h2 id="图像直方图"><a href="#图像直方图" class="headerlink" title="图像直方图"></a>图像直方图</h2><p>图像直方图用来统计图像中像素值的分布情况，即统计不同像素值出现的次数。方法为调用<code>matplotlib.pyplot</code>的<code>hist</code>方法，参数传入图像像素序列和统计区间个数。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> matplotlib.cm <span class="keyword">as</span> cm</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="comment"># 读入图片并转化为灰度图</span></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>).convert(<span class="string">"L"</span>)</div><div class="line">image_array = np.array(img)</div><div class="line"><span class="comment">#画图</span></div><div class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>)</div><div class="line">plt.imshow(img,cmap=cm.gray)</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line">plt.subplot(<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>)</div><div class="line">plt.hist(image_array.flatten(), <span class="number">256</span>) <span class="comment">#flatten 可以将矩阵转化为一维序列</span></div><div class="line"></div><div class="line">plt.show()<span class="comment">#显示图片，要不然没有办法显示</span></div></pre></td></tr></table></figure>
<p><img src="python-PIL-matplotlib/img_hist.png" alt="img_hist"></p>
<h2 id="图像灰度变换"><a href="#图像灰度变换" class="headerlink" title="图像灰度变换"></a>图像灰度变换</h2><p>对于一张灰度图像，其每个像素点都用一个0-255之间的值表示，0表示黑色，越接近0越黑；255表示白色，越接近255越白。<br>灰度变换就是通过一个特定的函数，使灰度值从一个值转换成另外一个值。<br>这里列出3种灰度变换</p>
<ol>
<li><p>【反相】变换后的灰度值= 255−原灰度值</p>
</li>
<li><p>【转换到100-200】变换后的灰度值 =(原灰度值/255)*100+100</p>
</li>
<li><p>【像素平方】变换后的灰度值 = 255*(原灰度值/255)2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> matplotlib.cm <span class="keyword">as</span> cm</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"><span class="comment"># 读入图片并转化为灰度图</span></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>).convert(<span class="string">"L"</span>)</div><div class="line">image_array = np.array(img)</div><div class="line"></div><div class="line">x = np.arange(<span class="number">255</span>)</div><div class="line"><span class="comment">#画图</span></div><div class="line"><span class="comment"># 反相</span></div><div class="line">plt.subplot(<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</div><div class="line">plt.plot(x,<span class="number">255</span>-x) <span class="comment"># 画出变换函数图像</span></div><div class="line">plt.subplot(<span class="number">3</span>,<span class="number">2</span>,<span class="number">2</span>)</div><div class="line">plt.imshow(Image.fromarray(<span class="number">255</span>-image_array),cmap=cm.gray)</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 转换到 100-200</span></div><div class="line">plt.subplot(<span class="number">3</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">plt.plot(x,(x/<span class="number">255.0</span>)*<span class="number">100</span>+<span class="number">100</span>) <span class="comment"># 画出变换函数图像</span></div><div class="line">plt.subplot(<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>)</div><div class="line">plt.imshow( Image.fromarray((image_array/<span class="number">255.0</span>)*<span class="number">100</span>+<span class="number">100</span>), cmap=cm.gray )</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line"></div><div class="line"><span class="comment"># 像素平方</span></div><div class="line">plt.subplot(<span class="number">3</span>,<span class="number">2</span>,<span class="number">5</span>)</div><div class="line">plt.plot(x,<span class="number">255</span>*(x/<span class="number">255.0</span>)**<span class="number">2</span>) <span class="comment"># 画出变换函数图像</span></div><div class="line">plt.subplot(<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>)</div><div class="line">plt.imshow( Image.fromarray(<span class="number">255</span>*(image_array/<span class="number">255.0</span>)**<span class="number">2</span>), cmap=cm.gray )</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line"></div><div class="line">plt.show()</div></pre></td></tr></table></figure>
</li>
</ol>
<p><img src="python-PIL-matplotlib/gray_change.png" alt="gray_changed"></p>
<h2 id="直方图均衡化"><a href="#直方图均衡化" class="headerlink" title="直方图均衡化"></a>直方图均衡化</h2><p>由上面图像的直方图可以看出，一般情况下，图像上某些灰度值较多，有些灰度值较少，直方图均衡化为的是使灰度值较为均衡。</p>
<p>直方图均衡化是利用直方图的累积函数作为灰度变换函数，对图像进行转换。直方图均衡化可以增强图像的对比度。</p>
<p>累积函数和概率论中的累积分布函数类似。例如对于还有5个数的序列[1,2,3,4,5],其累积函数含有5个数，第一个数是1，第二个是1+2=3，……，第五个数是1+2+3+4+5=15，所以其累积函数是[1,3,6,10,15]。</p>
<p>我们把直方图均衡化的过程封装在一个函数里面，函数名字叫做histeq，输入原图像矩阵和直方图分块数，输出均衡化后的图像矩阵和累积函数。<img src="" alt=""></p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div><div class="line"><span class="keyword">import</span> matplotlib.cm <span class="keyword">as</span> cm</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">histeq</span><span class="params">(image_array, image_bins=<span class="number">256</span>)</span>:</span></div><div class="line">    <span class="comment"># 将图像矩阵转化成直方图数据，返回元组(频数，直方图区间坐标)</span></div><div class="line">    image_array2, bins = np.histogram(image_array.flatten(), image_bins)</div><div class="line"></div><div class="line">    <span class="comment"># 计算直方图的累积函数</span></div><div class="line">    cdf = image_array2.cumsum()</div><div class="line"></div><div class="line">    <span class="comment"># 将累积函数转化到区间[0,255]</span></div><div class="line">    cdf = (<span class="number">255.0</span> / cdf[<span class="number">-1</span>]) * cdf</div><div class="line"></div><div class="line">    <span class="comment"># 原图像矩阵利用累积函数进行转化，插值过程</span></div><div class="line">    image2_array = np.interp(image_array.flatten(), bins[:<span class="number">-1</span>], cdf)</div><div class="line"></div><div class="line">    <span class="comment"># 返回均衡化后的图像矩阵和累积函数</span></div><div class="line">    <span class="keyword">return</span> image2_array.reshape(image_array.shape), cdf</div><div class="line"></div><div class="line"><span class="comment"># 读入图片并转化为灰度图</span></div><div class="line">img = Image.open(<span class="string">'000001.jpg'</span>).convert(<span class="string">"L"</span>)</div><div class="line">image_array = np.array(img)</div><div class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)</div><div class="line">plt.hist(image_array.flatten(),<span class="number">256</span>)</div><div class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>)</div><div class="line">plt.imshow(img,cmap=cm.gray)</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line"></div><div class="line">a = histeq(image_array)  <span class="comment"># 利用刚定义的直方图均衡化函数对图像进行均衡化处理</span></div><div class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>)</div><div class="line">plt.hist(a[<span class="number">0</span>].flatten(),<span class="number">256</span>)</div><div class="line">plt.subplot(<span class="number">2</span>,<span class="number">2</span>,<span class="number">4</span>)</div><div class="line">plt.imshow(Image.fromarray(a[<span class="number">0</span>]),cmap=cm.gray)</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line"></div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<p><img src="python-PIL-matplotlib/hist_norm.png" alt="直方图均衡"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/17/python-PIL-matplotlib/" data-id="cj0kkdjyz000i4sflp5ea5fq6" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-PIL-matplotlib/">python, PIL, matplotlib</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-python-parse-VOCxml-and-show" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/15/python-parse-VOCxml-and-show/" class="article-date">
  <time datetime="2017-03-15T08:48:22.000Z" itemprop="datePublished">2017-03-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/15/python-parse-VOCxml-and-show/">python_parse_VOCxml_and_show</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天详细的处理了 一下VOC的XML 文件，包括将xml 解析出来，并将bbox显示出来。</p>
<h1 id="简要介绍一下VOC的xml文件"><a href="#简要介绍一下VOC的xml文件" class="headerlink" title="简要介绍一下VOC的xml文件"></a>简要介绍一下VOC的xml文件</h1><p>VOC的检测任务的目标标签是写在对应xml文件中的。一般xml文件会包含对应图片的名字，尺寸，以及难度，以及所有目标的名字，和boundingbox的对角坐标。</p>
<p>下面给出一个xml的示例：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">folder</span>&gt;</span>VOC2007<span class="tag">&lt;/<span class="name">folder</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">filename</span>&gt;</span>000001.jpg<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">source</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">database</span>&gt;</span>The VOC2007 Database<span class="tag">&lt;/<span class="name">database</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">annotation</span>&gt;</span>PASCAL VOC2007<span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">image</span>&gt;</span>flickr<span class="tag">&lt;/<span class="name">image</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">flickrid</span>&gt;</span>341012865<span class="tag">&lt;/<span class="name">flickrid</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">owner</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">flickrid</span>&gt;</span>Fried Camels<span class="tag">&lt;/<span class="name">flickrid</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>Jinky the Fruit Bat<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">owner</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">size</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">width</span>&gt;</span>353<span class="tag">&lt;/<span class="name">width</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">height</span>&gt;</span>500<span class="tag">&lt;/<span class="name">height</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">size</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">segmented</span>&gt;</span>0<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>dog<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Left<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>1<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>48<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>240<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>195<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>371<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>person<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Left<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>1<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>8<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>12<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>352<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>498<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></div></pre></td></tr></table></figure>
<p>对应的图片是：</p>
<p><img src="python-parse-VOCxml-and-show/000001.jpg" alt="000001.jpg"></p>
<h1 id="python解析XML文件"><a href="#python解析XML文件" class="headerlink" title="python解析XML文件"></a>python解析XML文件</h1><h2 id="导入xml包"><a href="#导入xml包" class="headerlink" title="导入xml包"></a>导入xml包</h2><p><code>import xml.etree.ElementTree as ET</code></p>
<p><strong>直接贴代码</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_rec</span><span class="params">(filename)</span>:</span></div><div class="line">    <span class="string">"""parse a pascal voc xml file"""</span></div><div class="line">    tree = ET.parse(filename) <span class="comment"># </span></div><div class="line">    objects = []</div><div class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> tree.findall(<span class="string">'object'</span>):</div><div class="line">        obj_struct = &#123;&#125;</div><div class="line">        obj_struct[<span class="string">'name'</span>] = obj.find(<span class="string">'name'</span>).text</div><div class="line">        obj_struct[<span class="string">'pose'</span>] = obj.find(<span class="string">'pose'</span>).text</div><div class="line">        obj_struct[<span class="string">'truncated'</span>] = int(obj.find(<span class="string">'truncated'</span>).text)</div><div class="line">        obj_struct[<span class="string">'difficult'</span>] = int(obj.find(<span class="string">'difficult'</span>).text)</div><div class="line">        bbox = obj.find(<span class="string">'bndbox'</span>)</div><div class="line">        obj_struct[<span class="string">'bbox'</span>] = [int(bbox.find(<span class="string">'xmin'</span>).text),</div><div class="line">                              int(bbox.find(<span class="string">'ymin'</span>).text),</div><div class="line">                              int(bbox.find(<span class="string">'xmax'</span>).text),</div><div class="line">                              int(bbox.find(<span class="string">'ymax'</span>).text)]</div><div class="line">        objects.append(obj_struct)</div><div class="line">    <span class="keyword">return</span> objects</div></pre></td></tr></table></figure>
<p>如此得到的结果是一个list, list中的元素就是每一个object, 可以看到object每一个都是一个dict(键值对)：</p>
<p><code>[{&#39;difficult&#39;: 0, &#39;pose&#39;: &#39;Left&#39;, &#39;name&#39;: &#39;dog&#39;, &#39;bbox&#39;: [48, 240, 195, 371], &#39;truncated&#39;: 1}, {&#39;difficult&#39;: 0, &#39;pose&#39;: &#39;Left&#39;, &#39;name&#39;: &#39;person&#39;, &#39;bbox&#39;: [8, 12, 352, 498], &#39;truncated&#39;: 1}]</code></p>
<h1 id="python显示xml结果"><a href="#python显示xml结果" class="headerlink" title="python显示xml结果"></a>python显示xml结果</h1><h2 id="导入matplotlib和PIL包"><a href="#导入matplotlib和PIL包" class="headerlink" title="导入matplotlib和PIL包"></a>导入matplotlib和PIL包</h2><figure class="highlight python"><table><tr><td class="code"><pre><div class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</div></pre></td></tr></table></figure>
<p><strong>直接贴代码</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><div class="line">image = Image.open(<span class="string">'000001.jpg'</span>)</div><div class="line"></div><div class="line"></div><div class="line">fig, ax = plt.subplots(figsize=(<span class="number">12</span>, <span class="number">12</span>))</div><div class="line">ax.imshow(image, aspect=<span class="string">'equal'</span>)</div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(object)):</div><div class="line">    bbox = object[i][<span class="string">'bbox'</span>]</div><div class="line">    name = object[i][<span class="string">'name'</span>]</div><div class="line">    ax.add_patch(</div><div class="line">        plt.Rectangle((bbox[<span class="number">0</span>], bbox[<span class="number">1</span>]),</div><div class="line">                        bbox[<span class="number">2</span>] - bbox[<span class="number">0</span>],</div><div class="line">                        bbox[<span class="number">3</span>] - bbox[<span class="number">1</span>], fill=<span class="keyword">False</span>,</div><div class="line">                      edgecolor=<span class="string">'red'</span>, linewidth=<span class="number">3.5</span></div><div class="line">        )</div><div class="line">    )<span class="comment">#画矩形</span></div><div class="line">    ax.text(bbox[<span class="number">0</span>], bbox[<span class="number">1</span>] - <span class="number">2</span>,</div><div class="line">            <span class="string">'&#123;:s&#125;'</span>.format(name),</div><div class="line">            bbox=dict(facecolor=<span class="string">'blue'</span>, alpha=<span class="number">0.5</span>),</div><div class="line">            fontsize=<span class="number">14</span>, color=<span class="string">'white'</span>)<span class="comment">#矩形框的标签</span></div><div class="line"></div><div class="line">ax.set_title(<span class="string">'parse image '</span>)</div><div class="line">plt.axis(<span class="string">"off"</span>)</div><div class="line">plt.tight_layout()</div><div class="line">plt.show()</div></pre></td></tr></table></figure>
<p>结果图：</p>
<p><img src="python-parse-VOCxml-and-show/result_parse_vocxml.png" alt="000001.jpg"></p>
<h1 id="后语"><a href="#后语" class="headerlink" title="后语"></a>后语</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/03/15/python-parse-VOCxml-and-show/" data-id="cj0kkdjyq00094sfl80gjuom4" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/python-VOCxml/">python VOCxml</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Written-LSTM" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/25/Written-LSTM/" class="article-date">
  <time datetime="2016-08-25T02:34:17.000Z" itemprop="datePublished">2016-08-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/25/Written-LSTM/">Written Memories:Understanding,Deriving and Extending the LSTM</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h1><p><strong>动机：</strong>锻炼一下自己的英文能力，同时加深对LSTM的理解。</p>
<p>   本文是对<a href="http://r2rt.com/written-memories-understanding-deriving-and-extending-the-lstm.html" target="_blank" rel="external">Written Memories: Understanding, Deriving and Extending the LSTM</a>的翻译。</p>
<p><strong>有什么错误请指正！</strong></p>
<p>   当我第一次接触 Long Short-Term Memory networks(LSTM)时，我很难理解它的复杂性。我甚至不理解为什么它以这种方式设计就可以产生很好地 效果。后来，我发现LSTM是可以被理解的。尽管它表面看起来很复杂。LSTM实际上是基于一系列十分简单，甚至优美的对于神经网络的一些深刻思考。我真希望这篇博客是我第一次学习循环神经网络。</p>
<p> <strong>在这篇博文中，我们将做如下几件事情：</strong></p>
<ol>
<li><p>我们将定义recurrent neural networks(RNNs)，我们将关注于RNNs的局限性，从而导致了LSTM的发展。</p>
</li>
<li><p>我们将介绍LSTM结构背后的直觉。然后我们以此为依据拓展LSTM。沿着这个思路，我们将派生出GRU。我们将推导出伪LSTM。而这种LSTM将比传统的LSTM的性能更好。</p>
</li>
<li><p>接下来我们将推广这些直觉的知识是怎么在最近的优秀的结构中得到运用的。比如（highway，残差网络，神经图灵机）。</p>
<p>本文是关于理论知识的，并没有实现的内容，至于使用Tensorflow实现RNNs可以参考如下的博客。<br><a href="http://r2rt.com/recurrent-neural-networks-in-tensorflow-i.html" target="_blank" rel="external"> Recurrent Neural Networks in Tensorflow I</a>和<a href="http://r2rt.com/recurrent-neural-networks-in-tensorflow-ii.html" target="_blank" rel="external">Recurrent Neural Networks in Tensorflow II</a>。</p>
</li>
</ol>
<h1 id="内容-快速链接："><a href="#内容-快速链接：" class="headerlink" title="内容/快速链接："></a>内容/快速链接：</h1><ul>
<li>递归神经网络</li>
<li>RNNs可以做什么？选择单位时间</li>
<li>主流的RNNs</li>
<li>信息变形，弥散，和爆炸敏感性</li>
<li>针对信息弥散的充要条件</li>
<li>沿着时间轴的后向传播和梯度弥散敏感度</li>
<li>解决梯度弥散和梯度爆炸问题</li>
<li>LSTMs背后的直觉知识：保存记忆</li>
<li>使用选择性的控制和协调</li>
<li>选择的机制：Gates</li>
<li>将Gates粘合在一起派生出了LSTM原型</li>
<li>三个模型：归一化原型，GRU, 以及伪LSTM</li>
<li>推导LSTM</li>
<li>有窥视孔的LSTM</li>
<li>基本的LSTM与伪LSTM的经验性比较</li>
<li>拓展LSTM</li>
</ul>
<h1 id="要求："><a href="#要求：" class="headerlink" title="要求："></a>要求：</h1><h6 id=""><a href="#" class="headerlink" title=" "></a> </h6><p>​    本篇文章假设读者已将熟悉了：</p>
<ol>
<li><p>前向神经网络</p>
</li>
<li><p>反向传播</p>
</li>
<li><p>基本的线性代数</p>
<p>   我们也将回顾一些其他的知识，让我们从RNNs开始吧。</p>
</li>
</ol>
<h1 id="循环神经网络"><a href="#循环神经网络" class="headerlink" title="循环神经网络"></a>循环神经网络</h1><p>​    </p>
<p>​    从一个时刻到下一个时刻，我们的大脑就像一个函数一样在工作，它从我们的感官（外部）和我们的思维（内部）得到输入，然后处理一番，得到以动作形式（外部）和新的想法（内部）的输出。例如，我们看到 一只熊，然后我们就会想到单词“熊”，我们可以构建一个神经网络来模拟这种行为，我们可以训练神经网络去联想到单词“熊”当它看到一张熊的照片的时候。但是我们的大脑不仅仅是一个只有一次的函数，它随着时间重复运行。我们看见一只熊，然后我们想到了单词“熊”,然后我们就会想到“跑”， 重要的是，将熊的图片转化为单词“熊的网络和将单词“熊”转化为”跑“的网络是十分相似的。同时，它也是一个 循环的函数，对于这样的函数我们可以用递归神经网络来模拟。</p>
<p>​    RNN网络是一系列完全相同的前向神经网络的组合，每一个前向神经网络处理每一个时间步，我们都称之为“RNN cells”.值得注意的是这个定义比我们通常的对RNN的定义(“vanilla” RNN将在下文中介绍作为LSTM的先驱)更为广泛。这些cells可以处理他们自己的输出，允许他们(cells)被组合。他们同时可以处理外部的输入，产生外部的输出。下面是单独一个RNN cell 的示例图：</p>
<p><img src="Written-LSTM/NH_SingleRNNcell.png" alt="Single_RNN_cell"></p>
<p>下面是三个RNN cell的组合的示例图：</p>
<p><img src="Written-LSTM/NH_ComposedRNNcells.png" alt="NH_Composed_RNN_cells"></p>
<p>​    你可以认为这种循环的输出是“状态”，他们被输入到下一个时间步。所以，一个“RNN cell” 接收前一个状态和现有的输入(可选)，然后输出现在的状态，以及现在的输出(可选)。</p>
<p>下面是“RNN cell” 的代数描述:<br>$$<br>\binom{s<em>{t}}{o</em>{t}} = f\binom{s<em>{t-1}}{x</em>{t}}<br>$$<br>其中：<br>$$<br>s<em>{t}和s</em>{t-1}表示当前和前一刻状态<br>$$</p>
<p>$$<br>o_{t}表示当前时刻的输出(可能是空)<br>$$</p>
<p>$$<br>x_{t}是当前状态的输入,f是当前的循环函数<br>$$</p>
<p>​    我们就大脑的运行方式：当前的神经元活动将会替代之前的神经元活动。我们可以将RNNs看做这种原地的操作，因为”RNN cell”是完全相同的，他们可以被看做是相同的对象，只是在每一个时间步他们的状态会被覆盖。下面是这个框架的示例图：</p>
<p><img src="Written-LSTM/NH_StateLoop.png" alt="NH_State_Loop"></p>
<p>​    大多数对于RNNs的介绍都是从”single cell loop”框架开始的，但是我认为读者应该会认为以上连续的框架会更加的直观，特别是考虑到反向传播的时候。当我们从”single cell loop”开始学习的额时候。RNN会被引入”unrolled”以得到上面所提到的连续的框架。</p>
<h1 id="RNNs可以做什么？选择单位时间"><a href="#RNNs可以做什么？选择单位时间" class="headerlink" title="RNNs可以做什么？选择单位时间"></a>RNNs可以做什么？选择单位时间</h1><p>​    </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/25/Written-LSTM/" data-id="cj0kkdjyp00064sflt9lxw276" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LSTM/">LSTM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-CUDA_installration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/22/CUDA_installration/" class="article-date">
  <time datetime="2016-08-22T10:28:02.000Z" itemprop="datePublished">2016-08-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/22/CUDA_installration/">CUDA安装教程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><strong>动机</strong>：重新整理一下CUDA的安装过程(虽然已经安装过很多次了)。</p>
<p><strong>环境</strong>： Ubuntu14.04， Titanx 显卡. </p>
<p><strong>待安装</strong>： <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="external">CUDA7.5</a>， <a href="https://developer.nvidia.com/rdp/cudnn-download#a-collapseOne" target="_blank" rel="external">cuDNN v5.1</a>(下载这个，你得先注册了。注册然后等一天，才有资格下载。).</p>
<p><a href="http://baike.baidu.com/link?url=etasXojff5VuHUkZFMvWztQXAlPxJjJrPSt0qsOH1NAmMi5quvZFnCgaEfJYbFQH8IiWUi8aox5Mw_yg-y6Htq" target="_blank" rel="external"><strong>简介</strong></a>: CUDA(Compute Unified Device Architecture)，是显卡厂商NVIDIA推出的运算平台。 CUDA™是一种由NVIDIA推出的通用并行计算架构，该架构使GPU能够解决复杂的计算问题。 它包含了CUDA指令集架构（ISA）以及GPU内部的并行计算引擎。 开发人员现在可以使用C语言来为CUDA™架构编写程序，C语言是应用最广泛的一种高级编程语言。所编写出的程序于是就可以在支持CUDA™的处理器上以超高性能运行。CUDA3.0已经开始支持C++和FORTRAN。</p>
<p><strong>Step1</strong>：<strong><em>下载所需的文件</em></strong></p>
<p>*首先从网站上下载<a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="external">CUDA</a> 和 <a href="https://developer.nvidia.com/rdp/cudnn-download#a-collapseOne" target="_blank" rel="external">cuDNN v5.1</a>。至于CUDA选择哪个版本的可以参考下图</p>
<p><img src="CUDA_installration/cuda7.5.jpg" alt="cuda7.5.jpg"></p>
<p><strong>Step2</strong>： <strong><em>安装CUDA</em></strong> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sudo dpkg -i cuda-repo-ubuntu1404-7-5-local_7.5-18_amd64.deb</div><div class="line">sudo apt-get update</div><div class="line">sudo apt-get install cuda</div></pre></td></tr></table></figure>
<p><strong>Step3</strong>： <strong><em>安装cuDNN</em></strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">  tar -zxvf cudnn-7.5-linux-x64-v5.1.tgz </div><div class="line">  <span class="built_in">cd</span> cudnn-7.5-linux-x64-v5.1 </div><div class="line">  sudo cp lib* /usr/<span class="built_in">local</span>/cuda/lib64/  <span class="comment">## 这一步是在 lib文件夹下面</span></div><div class="line">  sudo cp cudnn.h /usr/<span class="built_in">local</span>/cuda/include/ </div><div class="line"> </div><div class="line">  </div><div class="line">更新软连接</div><div class="line"></div><div class="line"></div><div class="line">  <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/cuda/lib64/  </div><div class="line">  sudo rm -rf libcudnn.so libcudnn.so.5  </div><div class="line">  sudo ln <span class="_">-s</span> libcudnn.so.5.0.5 libcudnn.so.5.0  </div><div class="line">  sudo ln <span class="_">-s</span> libcudnn.so.5.0 libcudnn.so</div></pre></td></tr></table></figure>
<p><strong>Step4</strong>：<strong><em>设置环境变量</em></strong></p>
<p>在/etc/profile中添加CUDA环境变量</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sudo gedit /etc/profile</div></pre></td></tr></table></figure>
<p>内容如下:</p>
<blockquote>
<p>PATH=/usr/local/cuda-7.5/bin:$PATH<br>export PATH</p>
</blockquote>
<p>保存后, 执行下列命令, 使环境变量立即生效</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">source /etc/profile</div></pre></td></tr></table></figure>
<p>同时需要添加lib库路径： 在 /etc/ld.so.conf.d/加入文件 cuda.conf, </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sudo gedit /etc/ld.so.conf.d/cuda.conf</div></pre></td></tr></table></figure>
<p>内容如下:</p>
<blockquote>
<p>/usr/local/cuda-7.5/lib64</p>
</blockquote>
<p>保存后，执行下列命令使之立刻生效</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">sudo ldconfig</div></pre></td></tr></table></figure>
<p><strong>DONE !</strong><br>检验一下安装情况吧：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">nvidia-smi</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/08/22/CUDA_installration/" data-id="cj0kkdjya00024sfldr4n7h3h" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CUDA/">CUDA</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CUDA/">CUDA</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LSTM/">LSTM</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-VOCxml/">python VOCxml</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-random/">python,  random</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-Algorithms/">python, Algorithms</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-PIL-matplotlib/">python, PIL, matplotlib</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-caffe/">python, caffe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python-exe/">python, exe</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/">test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/卷积/">卷积</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/CUDA/" style="font-size: 10px;">CUDA</a> <a href="/tags/LSTM/" style="font-size: 10px;">LSTM</a> <a href="/tags/python-VOCxml/" style="font-size: 10px;">python VOCxml</a> <a href="/tags/python-random/" style="font-size: 10px;">python,  random</a> <a href="/tags/python-Algorithms/" style="font-size: 10px;">python, Algorithms</a> <a href="/tags/python-PIL-matplotlib/" style="font-size: 10px;">python, PIL, matplotlib</a> <a href="/tags/python-caffe/" style="font-size: 10px;">python, caffe</a> <a href="/tags/python-exe/" style="font-size: 10px;">python, exe</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/卷积/" style="font-size: 10px;">卷积</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">八月 2016</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/03/22/Python写caffe层/">Python写caffe层</a>
          </li>
        
          <li>
            <a href="/2017/03/21/test/">Test</a>
          </li>
        
          <li>
            <a href="/2017/03/21/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/03/21/python-random/">Python-Random</a>
          </li>
        
          <li>
            <a href="/2017/03/21/python-to-exe/">Python创建exe文件</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 chengqishang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">about</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>